<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Aisha!</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Orbitron:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind Custom Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#0f172a',
                            purple: '#4c1d95',
                            pink: '#be185d',
                            gold: '#fbbf24',
                            rose: '#fda4af',
                            sepia: '#5D4037',
                            paper: '#f1e6c6'
                        }
                    },
                    fontFamily: {
                        script: ['"Great Vibes"', 'cursive'],
                        serif: ['"Playfair Display"', 'serif'],
                        sans: ['"Poppins"', 'sans-serif'],
                        tech: ['"Orbitron"', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'spin-slow': 'spin 12s linear infinite',
                        'bounce-slow': 'bounce 3s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* --- RESET & BASIC --- */
        :root {
            --cursor-size: 20px;
        }

        body {
            background-color: #0f172a;
            color: #fff;
            overflow-x: hidden;
            cursor: none; /* Hide default cursor */
            scroll-behavior: auto; /* Handled by JS for smoothness */
        }
        
        body.letter-open {
            overflow: hidden; /* Prevent scrolling when letter is open */
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #be185d, #4c1d95);
            border-radius: 5px;
        }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
            transition: all 0.3s ease;
            box-shadow: 0 10px 40px rgba(190, 24, 93, 0.2);
        }

        /* --- CURSOR --- */
        .cursor-dot, .cursor-outline {
            position: fixed; top: 0; left: 0;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            z-index: 9999;
            pointer-events: none;
        }
        .cursor-dot { width: 8px; height: 8px; background-color: #fbbf24; }
        .cursor-outline {
            width: 40px; height: 40px;
            border: 2px solid rgba(251, 191, 36, 0.5);
            transition: width 0.2s, height 0.2s, background-color 0.2s;
        }

        /* --- ANIMATIONS --- */
        .reveal {
            opacity: 0;
            transform: translateY(50px) scale(0.95);
            transition: all 1.2s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: transform, opacity;
        }
        .reveal.active {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        
        .neon-text {
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px #be185d, 0 0 30px #be185d, 0 0 40px #be185d;
        }

        /* --- ENVELOPE (Trigger) --- */
        .envelope-container { perspective: 1000px; cursor: pointer; }
        .envelope {
            position: relative; width: 300px; height: 200px; background: #fee2e2; 
            border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            display: flex; justify-content: center; align-items: center;
            transition: transform 0.5s;
        }
        @media (max-width: 400px) {
            .envelope { width: 260px; height: 180px; }
            .flap { border-left-width: 130px !important; border-right-width: 130px !important; border-top-width: 90px !important; }
        }
        .envelope:hover { transform: scale(1.05); }
        .flap {
            position: absolute; top: 0; left: 0; width: 0; height: 0;
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-top: 100px solid #fecaca;
            transform-origin: top; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); z-index: 20;
        }
        .envelope.open .flap { transform: rotateX(180deg); z-index: 0; }
        
        .letter-preview {
            position: absolute; bottom: 0; width: 90%; height: 80%; background: #fff;
            z-index: 10; transition: transform 0.6s 0.4s ease-out;
            border-radius: 4px; box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
        }
        .envelope.open .letter-preview { transform: translateY(-100px); }

        /* --- FULLSCREEN LETTER MODAL RESPONSIVE --- */
        #letter-modal {
            position: fixed; inset: 0; z-index: 11000;
            background: rgba(0, 0, 0, 0.85); /* Darker for better focus */
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.8s;
            padding: 20px;
        }
        #letter-modal.active { opacity: 1; pointer-events: auto; }

        /* Folded Paper Animation Wrapper */
        .letter-wrapper {
            position: relative;
            width: 100%; max-width: 600px;
            perspective: 2000px;
            will-change: transform;
            display: flex; justify-content: center;
        }

        /* The actual vintage paper */
        .vintage-paper {
            background-color: #f1e6c6;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(93, 64, 55, 0.03) 20px, transparent 25px),
                radial-gradient(circle at 90% 80%, rgba(93, 64, 55, 0.03) 40px, transparent 45px),
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
            color: #5D4037;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            font-family: 'Great Vibes', cursive;
            font-size: 1.4rem;
            line-height: 1.8;
            border-radius: 4px;
            position: relative;
            transform-style: preserve-3d;
            transform-origin: center;
            
            /* Responsive Dimensions */
            width: 100%;
            max-height: 85vh; /* Prevent overflowing screen height */
            overflow-y: auto; /* Scroll inside paper if too long */
            scrollbar-width: thin;
            scrollbar-color: #d4c5a0 transparent;

            transform: scaleY(0.05) scaleX(0.8);
            opacity: 0;
            transition: transform 1.2s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.5s ease-in;
        }

        /* Mobile Letter Fixes */
        @media (max-width: 640px) {
            .vintage-paper {
                padding: 60px 20px 30px 20px; /* Top padding for close button */
                font-size: 1.1rem;
                line-height: 1.6;
            }
        }

        #letter-modal.active .vintage-paper {
            transform: scaleY(1) scaleX(1);
            opacity: 1;
            transition-delay: 0.2s;
        }

        /* Close Button - Fixed to Viewport on Mobile for easy access, sticky inside paper on Desktop */
        .close-letter {
            position: absolute; 
            top: 10px; 
            right: 10px;
            width: 44px; height: 44px; /* Larger hit area */
            background: rgba(241, 230, 198, 0.9);
            border: 2px solid #5D4037; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-family: 'Playfair Display', serif; font-size: 24px; color: #5D4037;
            cursor: pointer; z-index: 100;
            opacity: 0; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            
            /* Sticky positioning so it stays visible during scroll */
            position: sticky;
            float: right;
            margin-bottom: 20px;
        }

        #letter-modal.active .close-letter { opacity: 1; transition-delay: 0.5s; }
        
        /* Content Fade */
        .letter-content { opacity: 0; transition: opacity 1s ease-in; }
        #letter-modal.active .letter-content { opacity: 1; transition-delay: 1.2s; }

        /* Loading Screen */
        #loader {
            position: fixed; inset: 0; background: #0f172a; z-index: 20000;
            display: flex; justify-content: center; align-items: center;
            transition: opacity 1s ease;
        }
    </style>
</head>
<body class="font-sans antialiased text-slate-200">

    <!-- Loading Screen -->
    <div id="loader">
        <div class="text-center">
            <div class="mb-4 text-6xl text-brand-pink animate-bounce">
                <i class="fas fa-heart"></i>
            </div>
            <h2 class="text-2xl font-serif text-brand-gold tracking-widest animate-pulse">LOADING LOVE...</h2>
            <div class="mt-4 w-64 h-2 bg-slate-800 rounded-full overflow-hidden relative">
                <div id="progress-bar" class="h-full bg-gradient-to-r from-brand-pink to-brand-purple w-0 transition-all duration-[2000ms] ease-out"></div>
            </div>
        </div>
    </div>

    <!-- Custom Cursor -->
    <div class="cursor-dot" id="cursor-dot"></div>
    <div class="cursor-outline" id="cursor-outline"></div>

    <!-- Canvas Background -->
    <canvas id="bg-canvas" class="fixed top-0 left-0 w-full h-full -z-10"></canvas>
    
    <!-- Floating Audio Player -->
    <div class="fixed bottom-6 right-6 z-50 glass rounded-full p-3 flex items-center gap-4 transition-all hover:scale-105 duration-300">
        <div class="w-10 h-10 rounded-full bg-slate-900 border border-brand-pink flex items-center justify-center animate-spin-slow" id="vinyl">
            <i class="fas fa-music text-brand-pink text-xs"></i>
        </div>
        <div class="hidden md:block">
            <p class="text-xs text-brand-gold font-bold"></p>
        </div>
        <button id="play-btn" class="text-white hover:text-brand-pink transition"><i class="fas fa-play"></i></button>
    </div>

    <main>
        <!-- HERO SECTION -->
        <section id="hero" class="min-h-screen flex flex-col justify-center items-center relative overflow-hidden p-6 pt-32 pb-32">
            
            <div class="z-10 text-center space-y-8 mt-10">
                <div class="inline-block relative px-4">
                    <h1 class="font-script text-5xl md:text-9xl text-transparent bg-clip-text bg-gradient-to-r from-brand-pink via-purple-400 to-brand-gold pb-4 animate-float drop-shadow-2xl leading-tight py-4">
                        Happy Birthday
                    </h1>
                </div>

                <h2 class="font-script text-5xl md:text-9xl text-transparent bg-clip-text bg-gradient-to-r from-brand-pink via-purple-400 to-brand-gold py-6 drop-shadow-2xl tracking-wide relative min-h-[80px] mt-2 leading-tight">
                    <span id="typewriter"></span>
                </h2>

                <!-- Countdown -->
                <div class="glass p-6 rounded-2xl inline-flex flex-wrap justify-center gap-4 md:gap-8 mt-12 transition-all duration-1000 transform opacity-0 translate-y-10" id="countdown-container">
                    <!-- JS will fill this -->
                </div>
                <!-- Special Message when Countdonw <= 0 -->
                 <div id="bday-message" class="hidden text-4xl font-serif text-brand-gold animate-bounce">
                    üéâ IT'S YOUR SPECIAL DAY! üéâ
                 </div>

                <div class="mt-16">
                    <button id="start-btn" class="group relative px-10 py-4 rounded-full glass overflow-hidden inline-block hover:scale-105 transition duration-300">
                        <span class="relative z-10 font-bold tracking-wider text-xl group-hover:text-brand-pink transition">START THE JOURNEY</span>
                        <div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-10 transition duration-300"></div>
                    </button>
                </div>
            </div>
            
            <div class="absolute bottom-10 left-1/2 -translate-x-1/2 animate-bounce">
                <i class="fas fa-chevron-down text-2xl text-white/50"></i>
            </div>
        </section>

        <!-- PHOTO GALLERY -->
        <section id="gallery" class="min-h-screen py-20 px-4 md:px-10 relative">
            <h2 class="text-center font-serif text-5xl mb-16 neon-text reveal">Our Beautiful Memories</h2>
            <div class="columns-1 md:columns-3 gap-8 space-y-8 max-w-7xl mx-auto">
                <!-- Memories -->
                <div class="polaroid bg-white p-3 shadow-xl transform rotate-1 reveal break-inside-avoid">
                    <img src="first.jpg" class="w-full h-full object-cover">
                    <p class="text-slate-800 font-script text-2xl text-center mt-2">First Date ‚ù§Ô∏è</p>
                </div>
                 <div class="polaroid bg-white p-3 shadow-xl transform -rotate-2 reveal break-inside-avoid">
                    <img src="justus.jpg" class="w-full h-full object-cover">
                    <p class="text-slate-800 font-script text-2xl text-center mt-2">Just Us ‚ú®</p>
                </div>
                <div class="polaroid bg-white p-3 shadow-xl transform rotate-2 reveal break-inside-avoid">
                    <img src="myfav.jpg" class="w-full h-full object-cover">
                    <p class="text-slate-800 font-script text-2xl text-center mt-2">My favourite you ‚ù§Ô∏è</p>
                </div>
            </div>
        </section>

        <!-- TIMELINE -->
        <section id="timeline" class="min-h-screen py-20 px-4">
            <h2 class="text-center font-serif text-5xl mb-20 neon-text reveal">Our Story</h2>
            <div class="max-w-4xl mx-auto relative">
                <!-- Center Line -->
                <div class="absolute left-4 md:left-1/2 transform md:-translate-x-1/2 h-full w-1 bg-gradient-to-b from-brand-pink to-brand-purple rounded-full"></div>
                
                <!-- Event 1: Proposal -->
                <div class="relative mb-20 reveal">
                   <div class="flex flex-col md:flex-row items-start md:items-center w-full pl-12 md:pl-0">
                       <div class="w-full md:w-5/12 hidden md:block"></div>
                       
                       <!-- Dot -->
                       <div class="absolute md:relative left-[-1.35rem] md:left-auto md:mx-auto z-20 w-12 h-12 bg-brand-pink rounded-full border-4 border-slate-900 flex items-center justify-center shadow-lg shadow-brand-pink/50">
                           <i class="fas fa-ring text-white"></i>
                       </div>

                       <div class="w-full md:w-5/12 glass-card p-6 rounded-xl border-l-4 border-brand-pink relative hover:scale-105 transition duration-300 md:ml-0 md:text-left">
                           <h3 class="font-bold text-xl text-brand-gold font-serif">She Said Yes! üíç</h3>
                           <p class="text-brand-rose text-sm mb-2 font-mono">14th November, 2024</p>
                           <p class="text-sm text-slate-300">The most magical moment when you accepted my proposal. My life truly began that day.</p>
                       </div>
                   </div>
                </div>

                <!-- Event 2: First Date -->
                <div class="relative mb-20 reveal">
                   <div class="flex flex-col md:flex-row items-start md:items-center w-full pl-12 md:pl-0">
                       <div class="w-full md:w-5/12 glass-card p-6 rounded-xl border-l-4 md:border-l-0 md:border-r-4 border-brand-purple relative hover:scale-105 transition duration-300 md:text-right">
                           <h3 class="font-bold text-xl text-brand-gold font-serif">First Date üç∑</h3>
                           <p class="text-brand-rose text-sm mb-2 font-mono">5th July, 2025</p>
                           <p class="text-sm text-slate-300">A beautiful day I'll never forget. Just you, me, and endless memories.</p>
                       </div>
                       
                       <!-- Dot -->
                        <div class="absolute md:relative left-[-1.35rem] md:left-auto md:mx-auto z-20 w-12 h-12 bg-brand-purple rounded-full border-4 border-slate-900 flex items-center justify-center shadow-lg shadow-brand-purple/50">
                           <i class="fas fa-wine-glass text-white"></i>
                       </div>
                       
                       <div class="w-full md:w-5/12 hidden md:block"></div>
                   </div>
                </div>

                <!-- Event 3: Birthday -->
                <div class="relative mb-20 reveal">
                   <div class="flex flex-col md:flex-row items-start md:items-center w-full pl-12 md:pl-0">
                       <div class="w-full md:w-5/12 hidden md:block"></div>
                       
                       <!-- Dot -->
                       <div class="absolute md:relative left-[-1.35rem] md:left-auto md:mx-auto z-20 w-12 h-12 bg-brand-gold rounded-full border-4 border-slate-900 flex items-center justify-center shadow-lg shadow-brand-gold/50">
                           <i class="fas fa-gift text-white"></i>
                       </div>

                       <div class="w-full md:w-5/12 glass-card p-6 rounded-xl border-l-4 border-brand-gold relative hover:scale-105 transition duration-300">
                           <h3 class="font-bold text-xl text-brand-gold font-serif">Your Special Day üéÇ</h3>
                           <p class="text-brand-rose text-sm mb-2 font-mono">11th December, 2025</p>
                           <p class="text-sm text-slate-300">Celebrating the most amazing person in the world. Happy Birthday my love!</p>
                       </div>
                   </div>
                </div>

            </div>
        </section>

        <!-- REASONS -->
        <section id="reasons" class="py-20 px-4 bg-brand-dark/50">
            <h2 class="text-center font-serif text-5xl mb-10 neon-text reveal">Why I Love You</h2>
            <div class="max-w-2xl mx-auto glass p-10 rounded-2xl relative min-h-[300px] flex items-center justify-center text-center reveal">
                <button id="prev-reason" class="absolute left-4 text-3xl text-brand-pink hover:scale-125 transition"><i class="fas fa-chevron-left"></i></button>
                <div id="reason-content" class="text-3xl font-script text-white transition-opacity duration-500">
                    "Your smile makes my day ‚ù§Ô∏è"
                </div>
                <button id="next-reason" class="absolute right-4 text-3xl text-brand-pink hover:scale-125 transition"><i class="fas fa-chevron-right"></i></button>
            </div>
        </section>

        <!-- GAMES -->
        <section id="games" class="py-20 px-4">
             <h2 class="text-center font-serif text-5xl mb-16 neon-text reveal">Fun & Games</h2>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto">
                <div class="glass-card p-8 rounded-2xl text-center reveal">
                    <h3 class="text-2xl font-bold mb-4 text-brand-rose">Love Calculator</h3>
                    <button id="calc-love" class="w-full py-3 bg-brand-pink rounded-lg font-bold">CALCULATE</button>
                    <div id="love-res" class="mt-4 text-4xl hidden">100% ‚ù§Ô∏è</div>
                </div>
                <div class="glass-card p-8 rounded-2xl text-center reveal relative min-h-[250px]" id="balloon-game">
                    <h3 class="text-2xl font-bold mb-4 text-brand-rose">Pop the Hearts</h3>
                    <p class="text-sm text-gray-400">Score: <span id="score">0</span></p>
                    <div id="balloon-container" class="absolute inset-0 overflow-hidden pointer-events-none"></div>
                </div>
             </div>
        </section>

        <!-- LETTER SECTION -->
        <section id="letter-section" class="min-h-[80vh] py-20 px-4 flex flex-col items-center justify-center">
            
            <h2 class="text-center font-serif text-4xl mb-10 text-white/80 reveal">I Wrote Something For You...</h2>
            
            <!-- Envelope Trigger -->
            <div class="envelope-container reveal" id="envelope-trigger">
                 <div class="envelope">
                     <div class="flap"></div>
                     <!-- Small preview card sliding out -->
                     <div class="letter-preview"></div>
                     <div class="text-brand-pink text-5xl z-10"><i class="fas fa-heart"></i></div>
                 </div>
                 <p class="text-center mt-5 text-brand-gold font-serif italic tracking-widest text-sm uppercase">Click to Open</p>
            </div>

            <!-- Cake -->
            <div class="mt-20 text-center reveal">
                <div id="cake-interaction" class="cursor-pointer text-8xl transition transform hover:scale-110 inline-block relative">
                    üéÇ
                    <div class="absolute -top-4 left-1/2 -translate-x-1/2 flex gap-1" id="candles">
                         <div class="w-2 h-6 bg-yellow-400 rounded-full animate-pulse"></div>
                         <div class="w-2 h-6 bg-yellow-400 rounded-full animate-pulse"></div>
                    </div>
                </div>
                <p class="mt-4 text-slate-400 text-sm">Make a wish & click the cake!</p>
            </div>
            
        </section>

        <footer class="py-10 text-center text-slate-500 text-sm">
            <p>Made with ‚ù§Ô∏è forever.</p>
        </footer>
    </main>

    <!-- === LETTER MODAL === -->
    <div id="letter-modal" role="dialog" aria-modal="true">
        <div class="letter-wrapper">
            <!-- Vintage Paper -->
            <div class="vintage-paper">
                <!-- Close Button -->
                <button class="close-letter" aria-label="Close letter">‚úï</button>
                
                <div class="letter-content">
                    <div class="text-right text-base font-serif mb-8 text-brand-sepia opacity-70">
                        11th December, 2025
                    </div>
                    
                    <h3 class="text-4xl mb-6 text-brand-sepia font-bold">My Dearest Aisha,</h3>
                    
                    <p class="mb-4">
                        As I sit down to write this, I realize how difficult it is to put into words just how much you mean to me.
                    </p>
                    <p class="mb-4">
                        Your smile truly does light up my world, and your kindness inspires me every single day. Watching you grow another year older is the greatest gift I could ask for.
                    </p>
                    <p class="mb-4">
                        I promise to always be there to handle your "cutest anger" and to cherish every moment we share. You are my universe.
                    </p>
                    <p class="mb-8">
                        May this birthday be as beautiful, magical, and wonderful as you are.
                    </p>
                    
                    <div class="text-right mt-12 transform -rotate-2">
                        <p class="text-2xl">With all my love,</p>
                        <p class="text-4xl font-bold text-brand-pink mt-2" style="font-family:'Great Vibes'">Your Love</p>
                    </div>
                </div>
                
                <!-- Fold Visuals -->
                <div class="crease crease-top"></div>
                <div class="crease crease-bottom"></div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script>
        // --- PRELOADER ---
        window.addEventListener('load', () => {
            const loader = document.getElementById('loader');
            document.getElementById('progress-bar').style.width = '100%';
            setTimeout(() => {
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                    initTypewriter();
                }, 1000);
            }, 2000);
        });

        // --- SMOOTH SCROLL ---
        document.getElementById('start-btn').addEventListener('click', (e) => {
            e.preventDefault();
            smoothScroll('#gallery', 2000); // 2 seconds duration
        });

        function smoothScroll(target, duration) {
            const targetEl = document.querySelector(target);
            if(!targetEl) return;
            const targetPos = targetEl.getBoundingClientRect().top + window.pageYOffset;
            const startPos = window.pageYOffset;
            const distance = targetPos - startPos;
            let startTime = null;

            function animation(currentTime) {
                if(startTime === null) startTime = currentTime;
                const timeElapsed = currentTime - startTime;
                const run = easeInOutCubic(timeElapsed, startPos, distance, duration);
                window.scrollTo(0, run);
                if(timeElapsed < duration) requestAnimationFrame(animation);
            }

            // Cubic Bezier Easing
            // t=time, b=start, c=change, d=duration
            function easeInOutCubic(t, b, c, d) {
                t /= d/2;
                if (t < 1) return c/2*t*t*t + b;
                t -= 2;
                return c/2*(t*t*t + 2) + b;
            }

            requestAnimationFrame(animation);
        }

        // --- LETTER LOGIC ---
        const envelopeTrigger = document.getElementById('envelope-trigger');
        const letterModal = document.getElementById('letter-modal');
        const closeLetterBtn = document.querySelector('.close-letter');
        const envelopeEl = document.querySelector('.envelope');

        envelopeTrigger.addEventListener('click', () => {
            // Stage 1: Open Flap
            envelopeEl.classList.add('open');
            
            // Stage 2: Wait for slide out, then open modal
            setTimeout(() => {
                letterModal.classList.add('active'); // Shows overlay and scales up paper
                document.body.classList.add('letter-open');
            }, 800);
        });

        closeLetterBtn.addEventListener('click', closeLetter);
        
        // Close on clicking outside
        letterModal.addEventListener('click', (e) => {
             if(e.target === letterModal) closeLetter();
        });
        
        // Close on Escape
        document.addEventListener('keydown', (e) => {
            if(e.key === 'Escape' && letterModal.classList.contains('active')) closeLetter();
        });

        function closeLetter() {
            letterModal.classList.remove('active');
            document.body.classList.remove('letter-open');
            
            // Reset envelope after animation finishes
            setTimeout(() => {
                envelopeEl.classList.remove('open');
            }, 800);
        }

        // --- BIRTHDAY DATE LOGIC ---
        // Target: Dec 11
        const now = new Date();
        const currentYear = now.getFullYear();
        let targetDate = new Date(currentYear, 11, 11); // Month is 0-indexed: 11 = Dec
        
        // If passed, move to next year
        if (now.getTime() > targetDate.getTime() + (24*60*60*1000)) { 
             targetDate.setFullYear(currentYear + 1);
        }
        
        const countdownEl = document.getElementById('countdown-container');
        
        function updateCountdown() {
            const currentTime = new Date();
            const diff = targetDate - currentTime;
            
            // Birthday Logic (If today is Dec 11)
            if (now.getDate() === 11 && now.getMonth() === 11) {
                countdownEl.style.display = 'none';
                document.getElementById('bday-message').classList.remove('hidden');
                return;
            }
            
            // Reveal countdown
            if(countdownEl.classList.contains('opacity-0')) {
                countdownEl.classList.remove('opacity-0', 'translate-y-10');
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            renderTimeUnit(days, 'Days');
            renderTimeUnit(hours, 'Hours');
            renderTimeUnit(minutes, 'Mins');
            renderTimeUnit(seconds, 'Secs');
        }
        
        function renderTimeUnit(val, label) {
             // Simple clear and rebuild for cleaner code, optimization possible if needed
             // But usually best to just update innerText of specific IDs. 
             // Reusing previous logic slightly modified:
             let container = document.getElementById('cnt-'+label);
             if(!container) {
                 container = document.createElement('div');
                 container.id = 'cnt-'+label;
                 container.className = 'text-center min-w-[80px]';
                 container.innerHTML = `<span class="block text-4xl font-mono text-brand-gold" id="val-${label}">00</span>
                                        <span class="text-xs uppercase tracking-widest text-slate-400">${label}</span>`;
                 countdownEl.appendChild(container);
             }
             document.getElementById('val-'+label).innerText = val < 10 ? '0'+val : val;
        }

        setInterval(updateCountdown, 1000);
        updateCountdown(); // Init immediately

        // --- NAME TYPEWRITER ---
        const typeText = "Aisha";
        const typeDest = document.getElementById('typewriter');
        let typeIdx = 0;
        function initTypewriter() {
            if(typeIdx < typeText.length) {
                typeDest.innerHTML += typeText.charAt(typeIdx);
                typeIdx++;
                setTimeout(initTypewriter, 200);
            }
        }

        // --- CANVAS PARTICLES (Rose + Stars) ---
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let width, height, particles = [];
        
        function resize() { width=canvas.width=window.innerWidth; height=canvas.height=window.innerHeight; }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random()*width; this.y = Math.random()*height;
                this.type = Math.random() > 0.7 ? 'petal' : 'star';
                this.opacity = Math.random();
                if(this.type==='petal'){
                    this.size = Math.random()*5+2; 
                    this.speedY = Math.random()+0.5; this.speedX = (Math.random()-0.5);
                    this.rotation = Math.random()*360; 
                    this.color = '#fda4af';
                } else {
                    this.size = Math.random()*2;
                    this.speedY = (Math.random()-0.5)*0.2; this.speedX = (Math.random()-0.5)*0.2;
                    this.color = Math.random()>0.9?'#fbbf24':'#fff';
                }
            }
            update() {
                this.y += this.speedY; this.x += this.speedX;
                if(this.type==='petal') this.rotation += 1;
                if(this.x<0||this.x>width||this.y<0||this.y>height) this.reset();
            }
            draw() {
                ctx.globalAlpha = this.opacity; ctx.fillStyle = this.color;
                if(this.type==='petal'){
                    ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(this.rotation*Math.PI/180);
                    ctx.beginPath(); ctx.ellipse(0,0,this.size,this.size/2,0,0,Math.PI*2); ctx.fill(); ctx.restore();
                } else {
                    ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI*2); ctx.fill();
                }
            }
        }
        for(let i=0;i<150;i++) particles.push(new Particle());
        function animate() { ctx.clearRect(0,0,width,height); particles.forEach(p=>{p.update();p.draw();}); requestAnimationFrame(animate); }
        animate();

        // --- 9. INTERACTIONS ---
        
        // Music Player Toggle
        const audio = new Audio('rockwithyou.mp3');
        audio.loop = true; // Optional: loop the song
        
        let isPlaying = false;
        const playBtn = document.getElementById('play-btn');
        const vinyl = document.getElementById('vinyl');
        
        playBtn.addEventListener('click', () => {
            isPlaying = !isPlaying;
            playBtn.innerHTML = isPlaying ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play"></i>';
            
            if(isPlaying) {
                vinyl.classList.remove('animate-spin-slow');
                vinyl.classList.add('animate-spin'); // fast spin
                audio.play().catch(e => console.log("Audio play failed (user interaction needed):", e));
            } else {
                vinyl.classList.remove('animate-spin');
                vinyl.classList.add('animate-spin-slow');
                audio.pause();
            }
        });

        // Reasons
        const reasons = ["Your smile makes my day ‚ù§Ô∏è", "Your eyes are so beautiful ‚ú®", "You have the cutest anger ever üò†üíï", "You are so caring üå∏"];
        let rIdx = 0;
        document.getElementById('next-reason').addEventListener('click', ()=>{ rIdx=(rIdx+1)%reasons.length; updateReason(); });
        document.getElementById('prev-reason').addEventListener('click', ()=>{ rIdx=(rIdx-1+reasons.length)%reasons.length; updateReason(); });
        function updateReason(){ const el=document.getElementById('reason-content'); el.style.opacity=0; setTimeout(()=>{el.innerText='"'+reasons[rIdx]+'"'; el.style.opacity=1;},500); }

        // Intersection Observer
        const observer = new IntersectionObserver((entries)=>{
            entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('active'); });
        }, { threshold: 0.1 });
        document.querySelectorAll('.reveal').forEach(el=>observer.observe(el));
        
        // Cake Wish
        document.getElementById('cake-interaction').addEventListener('click', function() {
            document.getElementById('candles').style.opacity = '0';
            // Simple confetti
            for(let i=0;i<50;i++){
                 const c = document.createElement('div');
                 c.className = 'fixed w-2 h-2 z-50';
                 c.style.background = ['#fbbf24','#be185d'][Math.floor(Math.random()*2)];
                 c.style.left='50%'; c.style.top='50%';
                 document.body.appendChild(c);
                 c.animate([{transform:'translate(0,0)'}, {transform:`translate(${(Math.random()-0.5)*500}px, ${(Math.random()-0.5)*500}px)`, opacity:0}], {duration:1000}).onfinish=()=>c.remove();
            }
        });

        // Love Calc
        document.getElementById('calc-love').addEventListener('click', ()=>{
             const res = document.getElementById('love-res');
             res.classList.remove('hidden'); res.classList.add('animate-bounce');
        });

        // --- BALLOON GAME ---
        const balloonContainer = document.getElementById('balloon-container');
        let score = 0;
        
        function spawnBalloon() {
            if(document.hidden) return; 
            const b = document.createElement('div');
            b.innerHTML = '<i class="fas fa-heart"></i>';
            b.classList.add('absolute', 'text-brand-pink', 'text-4xl', 'cursor-pointer', 'transition', 'hover:scale-125');
            b.style.pointerEvents = 'auto'; // Re-enable clicks
            b.style.left = Math.random() * 80 + 10 + '%';
            b.style.bottom = '-50px';
            b.style.textShadow = '0 0 10px rgba(190, 24, 93, 0.5)';
            
            balloonContainer.appendChild(b);

            const anim = b.animate([
                { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                { transform: `translateY(-350px) rotate(${Math.random()*90 - 45}deg)`, opacity: 0.8 } 
            ], {
                duration: 4000,
                easing: 'linear'
            });

            // Pop interaction
            b.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent bubbling
                score++;
                document.getElementById('score').innerText = score;
                
                // Pop visual
                b.innerHTML = '‚ú®'; 
                b.style.textShadow = '0 0 20px #fbbf24';
                anim.cancel();
                
                // Disappear anim
                b.animate([
                    { transform: 'scale(1)', opacity: 1 },
                    { transform: 'scale(2)', opacity: 0 }
                ], { duration: 300 }).onfinish = () => b.remove();
            });

            anim.onfinish = () => b.remove();
        }

        // Start spawning
        setInterval(spawnBalloon, 1000);

        // Custom Cursor
        const dot=document.getElementById('cursor-dot'), outline=document.getElementById('cursor-outline');
        window.addEventListener('mousemove', (e)=>{
             dot.style.left=e.clientX+'px'; dot.style.top=e.clientY+'px';
             outline.animate({left:e.clientX+'px', top:e.clientY+'px'}, {duration:500, fill:'forwards'});
        });
        
    </script>
</body>
</html>
